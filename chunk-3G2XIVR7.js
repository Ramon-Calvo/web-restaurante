import{Cb as o,N as g,a as l,b as u,fa as I}from"./chunk-RUVTLGDO.js";var v=class c{cartItems=I([]);TAX_RATE=.21;DELIVERY_FEE=2.5;items=this.cartItems.asReadonly();itemCount=o(()=>this.cartItems().reduce((e,t)=>e+t.quantity,0));subtotal=o(()=>this.cartItems().reduce((e,t)=>e+t.totalPrice,0));baseImponible=o(()=>this.subtotal()/(1+this.TAX_RATE));tax=o(()=>this.subtotal()-this.baseImponible());total=o(()=>this.subtotal()+this.DELIVERY_FEE);cart=o(()=>({items:this.cartItems(),subtotal:this.subtotal(),tax:this.tax(),deliveryFee:this.DELIVERY_FEE,total:this.total()}));constructor(){this.loadCartFromStorage()}addItem(e,t=1,r=[],a){console.log("\u{1F6D2} CartService.addItem llamado:",{menuItem:e,quantity:t,customizations:r});let d=r.reduce((i,n)=>i+n.price,0),m=(e.price+d)*t,s={id:this.generateCartItemId(),menuItem:e,quantity:t,selectedCustomizations:r,totalPrice:m,specialInstructions:a};console.log("\u{1F6D2} CartService: Nuevo cartItem creado:",s),this.cartItems.update(i=>{let n=[...i,s];return console.log("\u{1F6D2} CartService: Items actualizados. Total:",n.length),n}),this.saveCartToStorage(),console.log("\u{1F6D2} CartService: Estado final - itemCount:",this.itemCount())}updateQuantity(e,t){if(t<=0){this.removeItem(e);return}this.cartItems.update(r=>r.map(a=>{if(a.id===e){let d=a.selectedCustomizations.reduce((s,i)=>s+i.price,0),m=(a.menuItem.price+d)*t;return u(l({},a),{quantity:t,totalPrice:m})}return a})),this.saveCartToStorage()}removeItem(e){this.cartItems.update(t=>t.filter(r=>r.id!==e)),this.saveCartToStorage()}clearCart(){this.cartItems.set([]),this.saveCartToStorage()}generateCartItemId(){return`cart-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}saveCartToStorage(){typeof window<"u"&&localStorage.setItem("kebab-cart",JSON.stringify(this.cartItems()))}loadCartFromStorage(){if(typeof window<"u"){let e=localStorage.getItem("kebab-cart");if(e)try{let t=JSON.parse(e);this.cartItems.set(t)}catch(t){console.error("Error loading cart from storage:",t)}}}static \u0275fac=function(t){return new(t||c)};static \u0275prov=g({token:c,factory:c.\u0275fac,providedIn:"root"})};export{v as a};
