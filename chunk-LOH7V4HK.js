import{a as R}from"./chunk-3G2XIVR7.js";import{a as j}from"./chunk-COEAG7CJ.js";import{a as G}from"./chunk-XR5YHNJE.js";import{a as F,b as L,e as z,j as B,m as q}from"./chunk-RZ2VWOOQ.js";import{f as A}from"./chunk-6Z5PNTCW.js";import{Ja as D,N as x,S as f,Ta as P,Tb as W,Ua as v,Va as O,Wa as V,X as g,Xa as N,Y as y,Ya as a,Za as r,a as S,b as k,cb as T,eb as C,fa as h,gb as c,lb as M,nb as s,pb as _,qb as I,rb as m,sb as p,tb as u,va as d}from"./chunk-RUVTLGDO.js";var w=class l{processing=h(!1);isProcessing=this.processing.asReadonly();async processPayment(i,e,n){this.processing.set(!0);try{switch(await new Promise(t=>setTimeout(t,2e3)),e){case"card":return await this.processCardPayment(i,n);case"paypal":return await this.processPayPalPayment(i);case"cash":return this.processCashPayment();default:throw new Error("M\xE9todo de pago no soportado")}}catch(t){return console.error("Payment error:",t),{success:!1,error:t instanceof Error?t.message:"Error desconocido"}}finally{this.processing.set(!1)}}async processCardPayment(i,e){return console.log("Processing card payment:",i,e),Math.random()>.1?{success:!0,transactionId:`TXN-CARD-${Date.now()}`}:{success:!1,error:"Tarjeta rechazada"}}async processPayPalPayment(i){return console.log("Processing PayPal payment:",i),{success:!0,transactionId:`TXN-PAYPAL-${Date.now()}`}}processCashPayment(){return{success:!0,transactionId:`TXN-CASH-${Date.now()}`}}validateCardNumber(i){let e=i.replace(/\s/g,"");if(!/^\d{13,19}$/.test(e))return!1;let n=0,t=!1;for(let o=e.length-1;o>=0;o--){let b=parseInt(e[o],10);t&&(b*=2,b>9&&(b-=9)),n+=b,t=!t}return n%10===0}validateExpiryDate(i,e){let n=new Date;return new Date(parseInt(e),parseInt(i)-1)>n}validateCVV(i){return/^\d{3,4}$/.test(i)}static \u0275fac=function(e){return new(e||l)};static \u0275prov=x({token:l,factory:l.\u0275fac,providedIn:"root"})};var E=class l{notifications=h([]);pushToken=h(null);permissionGranted=h(!1);allNotifications=this.notifications.asReadonly();unreadCount=h(0);token=this.pushToken.asReadonly();async requestPermission(){if(!("Notification"in window))return console.warn("Este navegador no soporta notificaciones"),!1;if(Notification.permission==="granted")return this.permissionGranted.set(!0),await this.initializePushNotifications(),!0;if(Notification.permission!=="denied"){let e=await Notification.requestPermission()==="granted";return this.permissionGranted.set(e),e&&await this.initializePushNotifications(),e}return!1}async initializePushNotifications(){console.log("Initializing push notifications...");let i=`FCM-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;this.pushToken.set(i)}showNotification(i,e,n){let t={id:`notif-${Date.now()}`,title:i,body:e,data:n,timestamp:new Date,read:!1};this.notifications.update(o=>[t,...o]),this.updateUnreadCount(),this.permissionGranted()&&"Notification"in window&&new window.Notification(i,{body:e,icon:"/assets/icons/icon-192x192.png",badge:"/assets/icons/badge-72x72.png",tag:t.id})}notifyOrderStatus(i,e){let t={pending:{title:"Pedido Recibido",body:`Tu pedido #${i} ha sido recibido`},confirmed:{title:"Pedido Confirmado",body:`Tu pedido #${i} ha sido confirmado`},preparing:{title:"Preparando Pedido",body:`Estamos preparando tu pedido #${i}`},ready:{title:"Pedido Listo",body:`Tu pedido #${i} est\xE1 listo`},out_for_delivery:{title:"En Camino",body:`Tu pedido #${i} est\xE1 en camino`},delivered:{title:"Pedido Entregado",body:`Tu pedido #${i} ha sido entregado. \xA1Buen provecho!`},cancelled:{title:"Pedido Cancelado",body:`Tu pedido #${i} ha sido cancelado`}}[e];this.showNotification(t.title,t.body,{orderId:i,status:e})}markAsRead(i){this.notifications.update(e=>e.map(n=>n.id===i?k(S({},n),{read:!0}):n)),this.updateUnreadCount()}markAllAsRead(){this.notifications.update(i=>i.map(e=>k(S({},e),{read:!0}))),this.updateUnreadCount()}deleteNotification(i){this.notifications.update(e=>e.filter(n=>n.id!==i)),this.updateUnreadCount()}updateUnreadCount(){let i=this.notifications().filter(e=>!e.read).length;this.unreadCount.set(i)}static \u0275fac=function(e){return new(e||l)};static \u0275prov=x({token:l,factory:l.\u0275fac,providedIn:"root"})};var X=(l,i)=>i.id;function J(l,i){if(l&1){let e=T();a(0,"section",4)(1,"h2"),s(2,"Direcci\xF3n de Entrega"),r(),a(3,"div",7)(4,"input",22),u("ngModelChange",function(t){g(e);let o=c();return p(o.address.street,t)||(o.address.street=t),y(t)}),r(),a(5,"input",23),u("ngModelChange",function(t){g(e);let o=c();return p(o.address.number,t)||(o.address.number=t),y(t)}),r(),a(6,"input",24),u("ngModelChange",function(t){g(e);let o=c();return p(o.address.floor,t)||(o.address.floor=t),y(t)}),r(),a(7,"input",25),u("ngModelChange",function(t){g(e);let o=c();return p(o.address.door,t)||(o.address.door=t),y(t)}),r(),a(8,"input",26),u("ngModelChange",function(t){g(e);let o=c();return p(o.address.city,t)||(o.address.city=t),y(t)}),r(),a(9,"input",27),u("ngModelChange",function(t){g(e);let o=c();return p(o.address.postalCode,t)||(o.address.postalCode=t),y(t)}),r(),a(10,"textarea",28),u("ngModelChange",function(t){g(e);let o=c();return p(o.address.additionalInfo,t)||(o.address.additionalInfo=t),y(t)}),r()()()}if(l&2){let e=c();d(4),m("ngModel",e.address.street),d(),m("ngModel",e.address.number),d(),m("ngModel",e.address.floor),d(),m("ngModel",e.address.door),d(),m("ngModel",e.address.city),d(),m("ngModel",e.address.postalCode),d(),m("ngModel",e.address.additionalInfo)}}function K(l,i){if(l&1){let e=T();a(0,"div",13)(1,"input",29),u("ngModelChange",function(t){g(e);let o=c();return p(o.cardNumber,t)||(o.cardNumber=t),y(t)}),r(),a(2,"div",30)(3,"input",31),u("ngModelChange",function(t){g(e);let o=c();return p(o.cardExpiry,t)||(o.cardExpiry=t),y(t)}),r(),a(4,"input",32),u("ngModelChange",function(t){g(e);let o=c();return p(o.cardCVV,t)||(o.cardCVV=t),y(t)}),r()()()}if(l&2){let e=c();d(),m("ngModel",e.cardNumber),d(2),m("ngModel",e.cardExpiry),d(),m("ngModel",e.cardCVV)}}function Q(l,i){if(l&1&&(a(0,"div",16)(1,"span"),s(2),r(),a(3,"span"),s(4),r()()),l&2){let e=i.$implicit;d(2),I("",e.quantity,"x ",e.menuItem.name),d(2),_("",e.totalPrice.toFixed(2),"\u20AC")}}function Z(l,i){if(l&1&&(a(0,"div",18)(1,"span"),s(2,"Gastos de env\xEDo"),r(),a(3,"span"),s(4),r()()),l&2){let e=c();d(4),_("",e.cart().deliveryFee.toFixed(2),"\u20AC")}}function $(l,i){l&1&&s(0," Procesando... ")}function ee(l,i){l&1&&s(0," Realizar Pedido ")}var U=class l{cartService=f(R);orderService=f(j);paymentService=f(w);notificationService=f(E);authService=f(G);router=f(A);cart=this.cartService.cart;deliveryType=h("delivery");paymentMethod=h("card");processing=h(!1);name="";phone="";email="";address={street:"",number:"",floor:"",door:"",city:"",postalCode:"",additionalInfo:""};cardNumber="";cardExpiry="";cardCVV="";setDeliveryType(i){this.deliveryType.set(i)}setPaymentMethod(i){this.paymentMethod.set(i)}isFormValid(){return!(!this.name||!this.phone||!this.email||this.deliveryType()==="delivery"&&(!this.address.street||!this.address.number||!this.address.city||!this.address.postalCode)||this.paymentMethod()==="card"&&(!this.cardNumber||!this.cardExpiry||!this.cardCVV))}async placeOrder(){if(!this.isFormValid()){alert("Por favor, completa todos los campos requeridos");return}this.processing.set(!0);try{let i={name:this.name,phone:this.phone,email:this.email,address:this.address,deliveryType:this.deliveryType()},e=await this.paymentService.processPayment(this.cart().total,this.paymentMethod(),this.paymentMethod()==="card"?{cardNumber:this.cardNumber,expiry:this.cardExpiry,cvv:this.cardCVV}:void 0);if(!e.success){alert("Error en el pago: "+e.error),this.processing.set(!1);return}let n={method:this.paymentMethod(),transactionId:e.transactionId,status:"completed"},t=this.authService.user()?.id||"guest",o=await this.orderService.createOrder(this.cart(),i,n,t);this.notificationService.notifyOrderStatus(o.id,o.status),this.cartService.clearCart(),this.router.navigate(["/orders",o.id])}catch(i){console.error("Error placing order:",i),alert("Hubo un error al procesar tu pedido. Por favor, int\xE9ntalo de nuevo.")}finally{this.processing.set(!1)}}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=D({type:l,selectors:[["app-checkout"]],decls:68,vars:22,consts:[[1,"checkout-page"],[1,"container"],[1,"checkout-content"],[1,"checkout-forms"],[1,"form-section"],[1,"delivery-type-selector"],[1,"delivery-btn",3,"click"],[1,"form-grid"],["type","text","placeholder","Nombre completo","required","",3,"ngModelChange","ngModel"],["type","tel","placeholder","Tel\xE9fono","required","",3,"ngModelChange","ngModel"],["type","email","placeholder","Email","required","",1,"full-width",3,"ngModelChange","ngModel"],[1,"payment-methods"],[1,"payment-btn",3,"click"],[1,"card-form"],[1,"order-summary"],[1,"summary-items"],[1,"summary-item"],[1,"summary-totals"],[1,"summary-row"],[1,"summary-row","summary-row--detail"],[1,"summary-row","summary-row--total"],[1,"btn","btn--place-order",3,"click","disabled"],["type","text","placeholder","Calle","required","",3,"ngModelChange","ngModel"],["type","text","placeholder","N\xFAmero","required","",3,"ngModelChange","ngModel"],["type","text","placeholder","Piso (opcional)",3,"ngModelChange","ngModel"],["type","text","placeholder","Puerta (opcional)",3,"ngModelChange","ngModel"],["type","text","placeholder","Ciudad","required","",3,"ngModelChange","ngModel"],["type","text","placeholder","C\xF3digo Postal","required","",3,"ngModelChange","ngModel"],["placeholder","Informaci\xF3n adicional (opcional)",1,"full-width",3,"ngModelChange","ngModel"],["type","text","placeholder","N\xFAmero de tarjeta",3,"ngModelChange","ngModel"],[1,"form-row"],["type","text","placeholder","MM/AA",3,"ngModelChange","ngModel"],["type","text","placeholder","CVV",3,"ngModelChange","ngModel"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"h1"),s(3,"Finalizar Pedido"),r(),a(4,"div",2)(5,"div",3)(6,"section",4)(7,"h2"),s(8,"Tipo de Entrega"),r(),a(9,"div",5)(10,"button",6),C("click",function(){return n.setDeliveryType("delivery")}),a(11,"span"),s(12,"\u{1F69A}"),r(),s(13," Entrega a Domicilio "),r(),a(14,"button",6),C("click",function(){return n.setDeliveryType("pickup")}),a(15,"span"),s(16,"\u{1F3EA}"),r(),s(17," Recoger en Tienda "),r()()(),a(18,"section",4)(19,"h2"),s(20,"Informaci\xF3n de Contacto"),r(),a(21,"div",7)(22,"input",8),u("ngModelChange",function(o){return p(n.name,o)||(n.name=o),o}),r(),a(23,"input",9),u("ngModelChange",function(o){return p(n.phone,o)||(n.phone=o),o}),r(),a(24,"input",10),u("ngModelChange",function(o){return p(n.email,o)||(n.email=o),o}),r()()(),P(25,J,11,7,"section",4),a(26,"section",4)(27,"h2"),s(28,"M\xE9todo de Pago"),r(),a(29,"div",11)(30,"button",12),C("click",function(){return n.setPaymentMethod("card")}),s(31," \u{1F4B3} Tarjeta "),r(),a(32,"button",12),C("click",function(){return n.setPaymentMethod("paypal")}),s(33," \u{1F17F}\uFE0F PayPal "),r(),a(34,"button",12),C("click",function(){return n.setPaymentMethod("cash")}),s(35," \u{1F4B5} Efectivo "),r()(),P(36,K,5,3,"div",13),r()(),a(37,"div",14)(38,"h2"),s(39,"Resumen del Pedido"),r(),a(40,"div",15),O(41,Q,5,3,"div",16,X),r(),a(43,"div",17)(44,"div",18)(45,"span"),s(46,"Subtotal (IVA incluido)"),r(),a(47,"span"),s(48),r()(),a(49,"div",19)(50,"span"),s(51,"- Base imponible"),r(),a(52,"span"),s(53),r()(),a(54,"div",19)(55,"span"),s(56,"- IVA (21%)"),r(),a(57,"span"),s(58),r()(),P(59,Z,5,1,"div",18),a(60,"div",20)(61,"span"),s(62,"Total a pagar"),r(),a(63,"span"),s(64),r()()(),a(65,"button",21),C("click",function(){return n.placeOrder()}),P(66,$,1,0)(67,ee,1,0),r()()()()()),e&2&&(d(10),M("active",n.deliveryType()==="delivery"),d(4),M("active",n.deliveryType()==="pickup"),d(8),m("ngModel",n.name),d(),m("ngModel",n.phone),d(),m("ngModel",n.email),d(),v(n.deliveryType()==="delivery"?25:-1),d(5),M("active",n.paymentMethod()==="card"),d(2),M("active",n.paymentMethod()==="paypal"),d(2),M("active",n.paymentMethod()==="cash"),d(2),v(n.paymentMethod()==="card"?36:-1),d(5),V(n.cartService.items()),d(7),_("",n.cart().subtotal.toFixed(2),"\u20AC"),d(5),_("",(n.cart().subtotal-n.cart().tax).toFixed(2),"\u20AC"),d(5),_("",n.cart().tax.toFixed(2),"\u20AC"),d(),v(n.deliveryType()==="delivery"?59:-1),d(5),_("",n.cart().total.toFixed(2),"\u20AC"),d(),N("disabled",n.processing()||!n.isFormValid()),d(),v(n.processing()?66:67))},dependencies:[W,q,F,L,B,z],styles:[".checkout-page[_ngcontent-%COMP%]{min-height:100vh;background:#f5f5f5;padding:2rem 0}.container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 1rem}h1[_ngcontent-%COMP%]{text-align:center;color:#333;margin-bottom:2rem;font-size:2.5rem}.checkout-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 400px;gap:2rem}.checkout-forms[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.form-section[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 2px 8px #0000001a}.form-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#333;margin-bottom:1.5rem;font-size:1.25rem}.delivery-type-selector[_ngcontent-%COMP%], .payment-methods[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem}.delivery-btn[_ngcontent-%COMP%], .payment-btn[_ngcontent-%COMP%]{padding:1rem;border:2px solid #ddd;background:#fff;border-radius:8px;cursor:pointer;transition:all .2s;font-size:1rem;display:flex;flex-direction:column;align-items:center;gap:.5rem}.delivery-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .payment-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.5rem}.delivery-btn[_ngcontent-%COMP%]:hover, .payment-btn[_ngcontent-%COMP%]:hover{border-color:#d32f2f}.delivery-btn.active[_ngcontent-%COMP%], .payment-btn.active[_ngcontent-%COMP%]{border-color:#d32f2f;background:#ffebee}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}.full-width[_ngcontent-%COMP%]{grid-column:1/-1}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{padding:.75rem 1rem;border:2px solid #ddd;border-radius:8px;font-size:1rem;transition:border-color .2s}input[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#d32f2f}textarea[_ngcontent-%COMP%]{min-height:80px;resize:vertical}.card-form[_ngcontent-%COMP%]{margin-top:1rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1rem}.order-summary[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 2px 8px #0000001a;height:fit-content;position:sticky;top:90px}.order-summary[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#333;margin-bottom:1.5rem;font-size:1.5rem}.summary-items[_ngcontent-%COMP%]{border-bottom:1px solid #eee;padding-bottom:1rem;margin-bottom:1rem}.summary-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.5rem 0;color:#666}.summary-totals[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;color:#666}.summary-row--detail[_ngcontent-%COMP%]{font-size:.9rem;color:#999;padding-left:1rem}.summary-row--total[_ngcontent-%COMP%]{border-top:2px solid #eee;padding-top:1rem;margin-top:.5rem;font-size:1.25rem;font-weight:700;color:#333}.btn--place-order[_ngcontent-%COMP%]{width:100%;padding:1rem;background:#d32f2f;color:#fff;border:none;border-radius:25px;font-weight:600;font-size:1.1rem;cursor:pointer;margin-top:1.5rem;transition:all .2s}.btn--place-order[_ngcontent-%COMP%]:hover:not(:disabled){background:#b71c1c;transform:translateY(-2px)}.btn--place-order[_ngcontent-%COMP%]:disabled{background:#ccc;cursor:not-allowed}@media (max-width: 968px){.checkout-content[_ngcontent-%COMP%]{grid-template-columns:1fr}.order-summary[_ngcontent-%COMP%]{position:static}.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{U as CheckoutComponent};
